<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Usage Cost Calculator Â· DressOn AI</title>
  <link rel="stylesheet" href="./styles.css">
  <style>
    .calc-wrap{max-width:880px;margin:48px auto;background:#18202b;border:1px solid var(--border);border-radius:16px;padding:20px}
    .row{display:flex;gap:12px;align-items:center;margin:8px 0}
    .row label{width:200px;color:#a3aec2}
    .row input{flex:1;height:42px;border-radius:10px;border:1px solid var(--border);background:#0e1320;color:var(--text);padding:0 10px}
    .btn-line{display:flex;gap:10px;margin-top:12px}
    .note{color:#8ea0b8;font-size:12px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .result{margin-top:16px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#121a2a}
  </style>
  <script type="module">
    const $ = (s)=>document.querySelector(s);
    const fmt = (n)=>Number(n||0).toLocaleString();
    const USD = (n)=>`$${(Number(n||0)).toFixed(6)}`;

    // Pricing (USD)
    const INPUT_TOKEN_PRICE = 0.00003;   // è¾“å…¥ tokensï¼š$0.00003/token
    const OUTPUT_IMAGE_PRICE = 0.039;    // è¾“å‡ºå›¾ç‰‡ï¼š$0.039/image (å›ºå®š)

    async function fetchTotals(){
      const r = await fetch('http://127.0.0.1:9091/usage/totals', { credentials:'include' });
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }

    function compute(tot){
      const totalImages = Number(tot.total_images||0);
      const inTok = Number(tot.total_input_tokens||0);
      const outTok = Number(tot.total_output_tokens||0);
      
      // æ€»æˆæœ¬ = è¾“å…¥ tokens è´¹ç”¨ + è¾“å‡ºå›¾ç‰‡è´¹ç”¨
      const inputCost = inTok * INPUT_TOKEN_PRICE;
      const outputCost = totalImages * OUTPUT_IMAGE_PRICE;
      const totalCost = inputCost + outputCost;
      
      // å¹³å‡æ¯å¼ å›¾çš„ token æ¶ˆè€—
      const avgInTok = totalImages>0 ? inTok/totalImages : 0;
      
      // å¹³å‡æ¯å¼ å›¾çš„ç¾å…ƒæˆæœ¬
      const avgCost = totalImages>0 ? totalCost/totalImages : 0;
      
      return { totalImages, inTok, outTok, totalCost, inputCost, outputCost, avgInTok, avgCost };
    }

    async function refresh(){
      try{
        const tot = await fetchTotals();
        const r = compute(tot);
        $('#total-images').textContent = fmt(r.totalImages);
        $('#total-in').textContent = fmt(r.inTok);
        $('#total-out').textContent = fmt(r.outTok);
        $('#input-cost').textContent = USD(r.inputCost);
        $('#output-cost').textContent = USD(r.outputCost);
        $('#total-cost').textContent = USD(r.totalCost);
        $('#avg-in-tok').textContent = fmt(Math.round(r.avgInTok));
        $('#avg-cost').textContent = USD(r.avgCost);
      }catch(e){ alert('Fetch totals failed: '+e); }
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      refresh();
      // æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ï¼ˆå¯é€‰ï¼‰
      setInterval(refresh, 5000);
    });
  </script>
</head>
<body>
  <div class="calc-wrap">
    <h2>Usage Cost Calculator</h2>
    <h3 style="color:var(--muted);font-size:18px;margin-top:8px">ç´¯è®¡ç»Ÿè®¡</h3>
    <div class="row"><label>æ€»ç”Ÿå›¾æ•°é‡</label><div class="mono" id="total-images">0</div></div>
    <div class="row"><label>æ€»è¾“å…¥ tokens</label><div class="mono" id="total-in">0</div></div>
    <div class="row"><label>æ€»è¾“å‡º tokens</label><div class="mono" id="total-out" style="color:var(--muted);opacity:0.6">0 (ä»…ä¾›å‚è€ƒ)</div></div>
    <div class="row"><label>è¾“å…¥ tokens è´¹ç”¨</label><div class="mono" id="input-cost">$0.000000</div></div>
    <div class="row"><label>è¾“å‡ºå›¾ç‰‡è´¹ç”¨</label><div class="mono" id="output-cost">$0.000000</div></div>
    <div class="row"><label>æ€»èŠ±è´¹</label><div class="mono" id="total-cost" style="font-weight:700">$0.000000</div></div>
    
    <hr style="border-color:var(--border);margin:20px 0">
    <h3 style="color:var(--muted);font-size:18px">å¹³å‡æ¯å¼ å›¾</h3>
    <div class="row"><label>å¹³å‡è¾“å…¥ tokens</label><div class="mono" id="avg-in-tok">0</div></div>
    <div class="row"><label>å¹³å‡èŠ±è´¹</label><div class="mono" id="avg-cost" style="color:var(--primary);font-weight:700">$0.000000</div></div>
    
    <div class="note" style="margin-top:20px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px">
      ğŸ’¡ <strong>è®¡ç®—å…¬å¼ï¼š</strong><br>
      æ€»æˆæœ¬ = (è¾“å…¥ tokens Ã— $0.00003) + (è¾“å‡ºå›¾ç‰‡æ•° Ã— <strong>$0.039</strong>)<br>
      å¹³å‡æ¯å¼ å›¾èŠ±è´¹ = æ€»æˆæœ¬ / æ€»å›¾æ•°<br>
      <br>
      ğŸ“Œ è¾“å…¥ä»·æ ¼ï¼š$0.00003/tokenï¼ˆæ–‡æœ¬/å›¾ç‰‡è¾“å…¥ï¼‰<br>
      ğŸ“Œ è¾“å‡ºä»·æ ¼ï¼š<strong>$0.039/å¼ </strong>ï¼ˆå›ºå®šï¼Œâ‰¤1024Ã—1024pxï¼‰<br>
      <br>
      æ•°æ®æ¯æ¬¡ NanoBanana ç”Ÿå›¾æˆåŠŸåè‡ªåŠ¨æ›´æ–°ï¼ˆæ¯ 5 ç§’åˆ·æ–°ï¼‰
    </div>
  </div>
</body>
</html>


