  <script type="module">
    // Tab Switching
    const tabBtns = document.querySelectorAll('.tab-btn');
    const viewSections = document.querySelectorAll('.view-section');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // Deactivate all
        tabBtns.forEach(b => b.classList.remove('active'));
        viewSections.forEach(v => v.classList.remove('active'));
        
        // Activate clicked
        btn.classList.add('active');
        const targetId = btn.dataset.target;
        document.querySelector(targetId).classList.add('active');
      });
    });

    // Billing toggle (Monthly / Yearly)
    const billingOptions = document.querySelectorAll('.billing-option');
    const monthlyElements = document.querySelectorAll('.monthly-price');
    const yearlyElements = document.querySelectorAll('.yearly-price');
    
    billingOptions.forEach(btn => {
      btn.addEventListener('click', () => {
        const period = btn.dataset.period;
        
        // Update active state
        billingOptions.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Toggle visibility
        if (period === 'monthly') {
          monthlyElements.forEach(el => el.style.display = '');
          yearlyElements.forEach(el => el.style.display = 'none');
        } else {
          monthlyElements.forEach(el => el.style.display = 'none');
          yearlyElements.forEach(el => el.style.display = '');
        }
      });
    });
    
    // Auth integration (reuse from main site)
    const signInBtn = document.querySelector('.sign-in-btn');
    const loginBtn = document.querySelector('.login-btn');
    const ctaButtons = document.querySelectorAll('.plan-cta');
    
    const goToLogin = () => {
      window.location.href = 'https://dresson-backend.onrender.com/auth/login';
    };

    // Default state: all buttons go to login
    if (signInBtn) signInBtn.addEventListener('click', goToLogin);
    if (loginBtn) loginBtn.addEventListener('click', goToLogin);
    
    const handleSubscribe = (planName) => {
      // Placeholder for actual payment logic
      alert(`Starting subscription flow for: ${planName}\n(Payment integration coming soon)`);
    };

    // Initial binding (will be updated if logged in)
    ctaButtons.forEach(btn => {
      btn.onclick = goToLogin;
    });
    
    // Check auth status
    fetch('https://dresson-backend.onrender.com/me', { credentials: 'include' })
      .then(r => r.ok ? r.json() : null)
      .then(user => {
        if (user) {
          // User is logged in
          document.documentElement.setAttribute('data-auth', 'on');
          
          // Update Avatar
          const avatar = document.querySelector('.profile-btn');
          if (avatar && user.name) {
            avatar.textContent = user.name.charAt(0).toUpperCase();
          }
          
          // Update Credits
          if (user.credits !== undefined) {
            const amount = document.querySelector('.credits .amount');
            if (amount) amount.textContent = user.credits.balance || '19050';
          }

          // Update Pricing Buttons
          ctaButtons.forEach(btn => {
            // Identify plan type
            const card = btn.closest('.pricing-card');
            const isCreditPack = card.closest('#credit-packs') !== null;
            const planName = card.querySelector('.plan-name').textContent;
            
            if (isCreditPack) {
              btn.textContent = 'Purchase Pack';
            } else {
              btn.textContent = 'Subscribe Now';
            }
            
            // Remove login listener, add subscribe listener
            btn.onclick = () => handleSubscribe(planName);
          });
        }
      })
      .catch(() => {});
  </script>
</body>
</html>
